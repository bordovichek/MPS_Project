<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Список аэропортов</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/list_airports.css' %}">
</head>
<body>
    <h1>Список аэропортов</h1>

    <form method="GET" class="search-form">
        <input type="text" name="search" placeholder="Поиск по названию или IATA коду..." value="{{ search_query|default_if_none:'' }}">

        {# Выпадающий список для сортировки #}
        <select name="sort_by" onchange="this.form.submit()">
            <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Сортировать по названию</option>
            <option value="iata_code" {% if sort_by == 'iata_code' %}selected{% endif %}>Сортировать по IATA коду</option>
            <option value="country" {% if sort_by == 'country' %}selected{% endif %}>Сортировать по стране</option>
        </select>

        <button type="submit">Найти</button>
    </form>

    <div class="pagination">
        {# Предыдущая страница #}
        {% if airports.has_previous %}
            <a href="?page={{ airports.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}">Предыдущая</a>
        {% else %}
            <span class="disabled-link">Предыдущая</span>
        {% endif %}

        {# Номера страниц #}
        {% for num in airports.paginator.page_range %}
            {% if airports.number == num %}
                <span class="current-page">{{ num }}</span>
            {% elif num > airports.number|add:'-3' and num < airports.number|add:'3' %}
                <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}">{{ num }}</a>
            {% elif num == airports.paginator.page_range.0 %}
                 <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}">{{ num }}</a>
                 {% if airports.number|add:'-3' > airports.paginator.page_range.0 %}<span>...</span>{% endif %}
            {% elif num == airports.paginator.page_range|last %}
                 {% if airports.number|add:'3' < airports.paginator.page_range|last %}<span>...</span>{% endif %}
                 <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}">{{ num }}</a>
            {% endif %}
        {% endfor %}

        {# Следующая страница #}
        {% if airports.has_next %}
            <a href="?page={{ airports.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}">Следующая</a>
        {% else %}
            <span class="disabled-link">Следующая</span>
        {% endif %}
    </div>

    {% for airport in airports %}
    <div class="airport">
        <h2><a href="{% url 'airport_detail' pk=airport.pk %}">{{ airport.name }}</a> {% if airport.iata_code %}({{ airport.iata_code }}){% endif %}</h2> {# Добавлена ссылка #}
        <p class="coordinates">Широта: {{ airport.latitude }}, Долгота: {{ airport.longitude }}</p>
        <p class="country">Страна: {{ airport.country }}</p>
        {% if airport.description %}
            <p class="description">{{ airport.description }}</p>
        {% endif %}
    </div>
    {% empty %}
    <p>Аэропорты не найдены.</p>
    {% endfor %}

    <div class="pagination">
        {# Предыдущая страница #}
        {% if airports.has_previous %}
            <a href="?page={{ airports.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}">Предыдущая</a>
        {% else %}
            <span class="disabled-link">Предыдущая</span>
        {% endif %}

        {# Номера страниц #}
        {% for num in airports.paginator.page_range %}
            {% if airports.number == num %}
                <span class="current-page">{{ num }}</span>
            {% elif num > airports.number|add:'-3' and num < airports.number|add:'3' %}
                <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}">{{ num }}</a>
            {% elif num == airports.paginator.page_range.0 %}
                 <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}">{{ num }}</a>
                 {% if airports.number|add:'-3' > airports.paginator.page_range.0 %}<span>...</span>{% endif %}
            {% elif num == airports.paginator.page_range|last %}
                 {% if airports.number|add:'3' < airports.paginator.page_range|last %}<span>...</span>{% endif %}
                 <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}">{{ num }}</a>
            {% endif %}
        {% endfor %}

        {# Следующая страница #}
        {% if airports.has_next %}
            <a href="?page={{ airports.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}">Следующая</a>
        {% else %}
            <span class="disabled-link">Следующая</span>
        {% endif %}
    </div>

</body>
</html>